# Vulnerability Hunting Workflow API Documentation

## Overview

This document provides comprehensive information about the vulnerability hunting workflow REST API endpoint. This workflow creates prioritized vulnerability testing plans for bug bounty hunting based on high-impact vulnerabilities.

## API Endpoint

**Path**: `/api/bugbounty/vulnerability-hunting`

**HTTP Method**: `POST`

**Content-Type**: `application/json`

## Parameters

### Required Parameters

- **domain** (string): The target domain to perform vulnerability hunting on
  - Example: `"example.com"`
  - This is the primary target for vulnerability testing

### Optional Parameters

- **priority_vulns** (array of strings): List of vulnerability types to prioritize in testing
  - Default: `["rce", "sqli", "xss", "idor", "ssrf"]`
  - Supported values:
    - `"rce"` - Remote Code Execution (Priority: 10)
    - `"sqli"` - SQL Injection (Priority: 9)
    - `"ssrf"` - Server-Side Request Forgery (Priority: 8)
    - `"idor"` - Insecure Direct Object Reference (Priority: 8)
    - `"xss"` - Cross-Site Scripting (Priority: 7)
    - `"lfi"` - Local File Inclusion (Priority: 7)
    - `"xxe"` - XML External Entity (Priority: 6)
    - `"csrf"` - Cross-Site Request Forgery (Priority: 5)

- **bounty_range** (string): Expected bounty range for the target
  - Default: `"unknown"`
  - Used for prioritization context
  - Example: `"$500-$2000"`

## Request Schema

```json
{
  "domain": "string (required)",
  "priority_vulns": ["string", "string", "..."] (optional),
  "bounty_range": "string (optional)"
}
```

## Response Schema

The endpoint returns a structured workflow with the following format:

```json
{
  "success": true,
  "workflow": {
    "target": "string",
    "vulnerability_tests": [
      {
        "vulnerability_type": "string",
        "priority": integer,
        "tools": ["string", "string", "..."],
        "payload_type": "string",
        "test_scenarios": [
          {
            "name": "string",
            "payloads": ["string", "string", "..."]
          }
        ],
        "estimated_time": integer
      }
    ],
    "estimated_time": integer,
    "priority_score": integer
  }
}
```

## Example Usage

### Basic Request

```bash
curl -X POST http://127.0.0.1:8888/api/bugbounty/vulnerability-hunting \
  -H "Content-Type: application/json" \
  -d '{
    "domain": "example.com"
  }'
```

### Advanced Request with Custom Priorities

```bash
curl -X POST http://127.0.0.1:8888/api/bugbounty/vulnerability-hunting \
  -H "Content-Type: application/json" \
  -d '{
    "domain": "target.bugbounty.com",
    "priority_vulns": ["rce", "sqli", "ssrf", "xss"],
    "bounty_range": "$1000-$5000"
  }'
```

### Example Response

```json
{
  "success": true,
  "workflow": {
    "target": "example.com",
    "vulnerability_tests": [
      {
        "vulnerability_type": "rce",
        "priority": 10,
        "tools": ["nuclei", "jaeles", "sqlmap"],
        "payload_type": "command_injection",
        "test_scenarios": [
          {
            "name": "Command Injection",
            "payloads": ["$(whoami)", "`id`", ";ls -la"]
          },
          {
            "name": "Code Injection",
            "payloads": ["<?php system($_GET['cmd']); ?>"]
          },
          {
            "name": "Template Injection",
            "payloads": ["{{7*7}}", "${7*7}", "#{7*7}"]
          }
        ],
        "estimated_time": 300
      },
      {
        "vulnerability_type": "sqli",
        "priority": 9,
        "tools": ["sqlmap", "nuclei"],
        "payload_type": "sql_injection",
        "test_scenarios": [
          {
            "name": "Union-based SQLi",
            "payloads": ["' UNION SELECT 1,2,3--", "' OR 1=1--"]
          }
        ],
        "estimated_time": 270
      }
    ],
    "estimated_time": 570,
    "priority_score": 19
  }
}
```

## Error Responses

### Missing Required Field

**Status Code**: `400 Bad Request`

```json
{
  "error": "Domain is required"
}
```

### Invalid JSON

**Status Code**: `400 Bad Request`

```json
{
  "error": "JSON data is required"
}
```

### Server Error

**Status Code**: `500 Internal Server Error`

```json
{
  "error": "Server error: [error details]"
}
```

## Logging

### Log File Location

Logs for this workflow are written to:
```
logs/workflows.vulnerability_hunting.log
```

### Log Format

```
YYYY-MM-DD HH:MM:SS,mmm - workflows.vulnerability_hunting.vulnerability_hunting - LEVEL - MESSAGE
```

### Sample Log Entries

```
2025-09-07 10:30:15,123 - workflows.vulnerability_hunting.vulnerability_hunting - INFO - Creating vulnerability hunting workflow for example.com
2025-09-07 10:30:15,456 - workflows.vulnerability_hunting.vulnerability_hunting - INFO - Vulnerability hunting workflow created for example.com
```

### Log Levels

- **INFO**: Normal workflow operations (creation start/completion)
- **ERROR**: Exceptions and failures during workflow creation
- **DEBUG**: Detailed execution information (when DEBUG=true environment variable is set)

## Configuration

### Environment Variables

- **BUGBOUNTY_MCP_HOST**: Server host (default: `127.0.0.1`)
- **BUGBOUNTY_MCP_PORT**: Server port (default: `8888`)
- **DEBUG**: Enable debug logging (default: `false`)

### Starting the Server

```bash
# Default configuration
uv run -m src.rest_api_server

# Custom configuration
DEBUG=true BUGBOUNTY_MCP_PORT=9000 uv run -m src.rest_api_server
```

## Workflow Features

### Vulnerability Prioritization

The workflow automatically prioritizes vulnerabilities based on impact scores:

1. **RCE (Remote Code Execution)** - Priority 10 (Highest)
2. **SQL Injection** - Priority 9
3. **SSRF/IDOR** - Priority 8
4. **XSS/LFI** - Priority 7
5. **XXE** - Priority 6
6. **CSRF** - Priority 5 (Lowest)

### Test Scenario Generation

Each vulnerability type includes specific test scenarios with payloads:

- **Command/Code/Template Injection** for RCE
- **Union/Boolean/Time-based** techniques for SQL Injection
- **Reflected/Stored/DOM** variants for XSS
- **Internal network/Cloud metadata/DNS exfiltration** for SSRF
- **Sequential ID/UUID/Path parameter** manipulation for IDOR

### Time Estimation

The workflow provides estimated testing time based on vulnerability priority:
- Higher priority vulnerabilities get more allocated testing time
- Time calculation: `priority * 30 seconds per vulnerability`
- Total workflow time is the sum of all vulnerability test times

This documentation provides complete information for developers and security researchers to effectively use the vulnerability hunting workflow API endpoint.
